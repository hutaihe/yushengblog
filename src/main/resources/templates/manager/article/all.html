<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>个人博客 | 所有文章</title>

    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">

    <link href="/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />

    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css" />

    <link href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css" rel="stylesheet" type="text/css" />

    <link href="/dist/css/AdminLTE.min.css" rel="stylesheet" type="text/css" />

    <link href="/dist/css/skins/_all-skins.min.css" rel="stylesheet" type="text/css" />

    <link href="/plugins/iCheck/flat/blue.css" rel="stylesheet" type="text/css" />

    <link href="/plugins/morris/morris.css" rel="stylesheet" type="text/css" />

    <link href="/plugins/jvectormap/jquery-jvectormap-1.2.2.css" rel="stylesheet" type="text/css" />

    <link href="/plugins/datepicker/datepicker3.css" rel="stylesheet" type="text/css" />

    <link href="/plugins/daterangepicker/daterangepicker-bs3.css" rel="stylesheet" type="text/css" />

    <link href="/plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css" rel="stylesheet" type="text/css" />


    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>

    <link href="/assets/css/lib/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/css/main/all.css" rel="stylesheet">

</head>
<body class="skin-blue sidebar-mini">
<div class="wrapper">
    <div th:insert="~{main :: menu}"></div>
    <div th:insert="~{main :: top}"></div>

    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <h1>
                文章管理
                <small><a th:href="@{/manager/article/toWriteArticle}">写文章</a></small>
            </h1>
            <ol class="breadcrumb">
                <li><a href="#"><i class="fa fa-dashboard"></i> 首页</a></li>
                <li class="active">文章管理</li>
                <li class="active">所有文章</li>
            </ol>
        </section>
        <div id="content">
            <div id="top">
                <ul>
                    <li onclick="showtab1()">已发布|</li>
                    <li onclick="showtab2()">待审核&nbsp;|</li>
                    <li onclick="showtab3()">草稿&nbsp;|</li>
                    <li onclick="showtab4()">回收站</li>
                </ul>
            </div>
            <div id="tab1">
                <table class="table">
                    <thead>
                    <tr>
                        <td style="width: 20%">标题</td>
                        <td style="width: 10%">作者</td>
                        <td>分类目录	</td>
                        <td style="width: 15%">标签</td>
                        <td style="width: 10%">评论</td>
                        <td style="width: 10%">访问量</td>
                        <td style="width: 10%">日期</td>
                        <td style="width: 15%">操作</td>
                    </tr>
                    </thead>
                    <tbody id="data2">
                    <tr >
                        <td colspan="8" style="text-align: center">暂无数据</td>
                    </tr>
                    </tbody>
                </table>
                <div class="tfoor data2">
                    <div class="tleft">第1 /0页</div>
                    <div class="trigth">
                        <ul class="hfoot">
                            <li>首页</li>
                            <li>上一页</li>
                            <li>下一页</li>
                            <li>尾页</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div id="tab2">
                <table class="table">
                    <thead>
                    <tr>
                        <td style="width: 20%">标题</td>
                        <td style="width: 10%">作者</td>
                        <td>分类目录	</td>
                        <td style="width: 15%">标签</td>
                        <td style="width: 10%">评论</td>
                        <td style="width: 10%">访问量</td>
                        <td style="width: 10%">日期</td>
                        <td style="width: 15%">操作</td>
                    </tr>
                    </thead>
                    <tbody id="data1">
                    <tr >
                        <td colspan="8" style="text-align: center">暂无数据</td>
                    </tr>
                    </tbody>
                </table>
                <div class="tfoor data1">
                    <div class="tleft">第1 /0页</div>
                    <div class="trigth">
                        <ul class="hfoot">
                            <li>首页</li>
                            <li>上一页</li>
                            <li>下一页</li>
                            <li>尾页</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div id="tab3">
                <table class="table">
                    <thead>
                    <tr>
                        <td style="width: 20%">标题</td>
                        <td style="width: 10%">作者</td>
                        <td>分类目录	</td>
                        <td style="width: 15%">标签</td>
                        <td style="width: 10%">评论</td>
                        <td style="width: 10%">访问量</td>
                        <td style="width: 10%">日期</td>
                        <td style="width: 15%">操作</td>
                    </tr>
                    </thead>
                    <tbody id="data0">
                    <tr >
                        <td colspan="8" style="text-align: center">暂无数据</td>
                    </tr>
                    </tbody>
                </table>
                <div class="tfoor data0">
                    <div class="tleft">第1 /0页</div>
                    <div class="trigth">
                        <ul class="hfoot">
                            <li>首页</li>
                            <li>上一页</li>
                            <li>下一页</li>
                            <li>尾页</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div id="tab4">
                <table class="table">
                    <thead>
                    <tr>
                        <td style="width: 20%">标题</td>
                        <td style="width: 10%">作者</td>
                        <td>分类目录	</td>
                        <td style="width: 15%">标签</td>
                        <td style="width: 10%">评论</td>
                        <td style="width: 10%">访问量</td>
                        <td style="width: 10%">日期</td>
                        <td style="width: 15%">操作</td>
                    </tr>
                    </thead>
                    <tbody id="data3">
                    <tr>
                        <td colspan="8" style="text-align: center">暂无数据</td>
                    </tr>
                    </tbody>
                </table>

                <div class="tfoor data3">
                    <div class="tleft">第1 /0页</div>
                    <div class="trigth">
                        <ul class="hfoot">
                            <li>首页</li>
                            <li>上一页</li>
                            <li>下一页</li>
                            <li>尾页</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer class="main-footer">
        <div class="pull-right hidden-xs">
            <b>Version</b> 2.2.0
        </div>
        <strong>Copyright &copy; 2014-2015 <a href="http://almsaeedstudio.com">Almsaeed Studio</a>.</strong> All rights reserved.
    </footer>
    <div class="control-sidebar-bg"></div>
</div>

<!-- jQuery 2.1.4 -->
<script src="/plugins/jQuery/jQuery-2.1.4.min.js"></script>
<!-- jQuery UI 1.11.4 -->
<script src="/https://code.jquery.com/ui/1.11.4/jquery-ui.min.js" type="text/javascript"></script>
<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
<script type="text/javascript">
    $.widget.bridge('uibutton', $.ui.button);
</script>
<!-- Bootstrap 3.3.2 JS -->
<script src="/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<!-- Morris.js charts -->
<script src="/https://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
<script src="plugins/morris/morris.min.js" type="text/javascript"></script>
<!-- Sparkline -->
<script src="/plugins/sparkline/jquery.sparkline.min.js" type="text/javascript"></script>
<!-- jvectormap -->
<script src="/plugins/jvectormap/jquery-jvectormap-1.2.2.min.js" type="text/javascript"></script>
<script src="/plugins/jvectormap/jquery-jvectormap-world-mill-en.js" type="text/javascript"></script>
<!-- jQuery Knob Chart -->
<script src="/plugins/knob/jquery.knob.js" type="text/javascript"></script>
<!-- daterangepicker -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.2/moment.min.js" type="text/javascript"></script>
<script src="/plugins/daterangepicker/daterangepicker.js" type="text/javascript"></script>
<!-- datepicker -->
<script src="/plugins/datepicker/bootstrap-datepicker.js" type="text/javascript"></script>
<!-- Bootstrap WYSIHTML5 -->
<script src="/plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js" type="text/javascript"></script>
<!-- Slimscroll -->
<script src="/plugins/slimScroll/jquery.slimscroll.min.js" type="text/javascript"></script>
<!-- FastClick -->
<script src="plugins/fastclick/fastclick.min.js" type="text/javascript"></script>
<!-- AdminLTE App -->
<script src="/dist/js/app.min.js" type="text/javascript"></script>
<!-- AdminLTE dashboard demo (This is only for demo purposes) -->
<script src="/dist/js/pages/dashboard.js" type="text/javascript"></script>
<!-- AdminLTE for demo purposes -->
<script src="/dist/js/demo.js" type="text/javascript"></script>
<script src="/layer/layer.js"></script>
<script>
    window.onload = function() {
        var status = GetQueryString("status");
        if(status == null){
            showtab1();
        }else{
            loadData(status,5,1); //什么转台的文章，一页五条数据
            if(status == 0){
                showtab3();
            }else if(status == 1){
                showtab2();
            }else if(status == 2){
                showtab1();
            }
            else if(status == 3){
                showtab4();
            }
        }
    }

    /*切换面板*/
    function showtab1(){
        $("#top ul li:eq(0)").css("color","black");
        $("#top ul li:eq(1)").css("color","#3498db");
        $("#top ul li:eq(2)").css("color","#3498db");
        $("#top ul li:eq(3)").css("color","#3498db");
        $("#tab1").show();
        $("#tab2").hide();
        $("#tab3").hide();
        $("#tab4").hide();
        loadData(2,5,1);
    }
    function showtab2(){
        $("#top ul li:eq(0)").css("color","#3498db");
        $("#top ul li:eq(1)").css("color","black");
        $("#top ul li:eq(2)").css("color","#3498db");
        $("#top ul li:eq(3)").css("color","#3498db");
        $("#tab2").show();
        $("#tab1").hide();
        $("#tab3").hide();
        $("#tab4").hide();
        loadData(1,5,1);
    }
    function showtab3(){
        $("#top ul li:eq(1)").css("color","#3498db");
        $("#top ul li:eq(2)").css("color","black");
        $("#top ul li:eq(0)").css("color","#3498db");
        $("#top ul li:eq(3)").css("color","#3498db");
        $("#tab3").show();
        $("#tab1").hide();
        $("#tab2").hide();
        $("#tab4").hide();
        loadData(0,5,1);
    }
    function showtab4(){
        $("#top ul li:eq(3)").css("color","black");
        $("#top ul li:eq(0)").css("color","#3498db");
        $("#top ul li:eq(1)").css("color","#3498db");
        $("#top ul li:eq(2)").css("color","#3498db");
        $("#tab4").show();
        $("#tab1").hide();
        $("#tab2").hide();
        $("#tab3").hide();
        loadData(3,5,1);
    }
    /*切换面板*/
    /*加载数据*/
    function loadData(data,pagesize,pageno){
        $.ajax({
            type : "post",
            url : "/manager/article/loadData",
            data : {
                "data" : data,
                "pagesize":pagesize,
                "pageno":pageno
            },
            success : function(result){
                if(result.success){
                    var page = result.page;
                    var datas = page.articleResults;
                    if(datas != null){
                        var content = "";
                        $.each(datas,function(i,n){
                            content += "<tr>";
                            content += "<td>"+n.title+"</td>";
                            content += "<td>"+n.username+"</td>";
                            content += "<td>"+n.typenames+"</td>";
                            content += "<td>"+n.labelnames+"</td>";
                            content += "<td>"+n.comnum+"</td>";
                            content += "<td>"+n.access+"</td>";
                            content += "<td>"+n.creationtime+"</td>";
                            if(data == 0){
                                content += "<td id='tranbtn'><button class='a1' id='editbtn' onclick='window.location.href=\"/manager/article/edit?id="+n.id+"\"'>编辑</button><button class='a2' onclick='release("+n.id+")'>发布</button><button class='a3' onclick='discard("+n.id+")'>丢弃</button></td>";
                            }
                            if(data == 1){
                                content += "<td id='tranbtn'><button class='a4' onclick='upperShelf("+n.id+")'>上架</button><button class='a1' id='editbtn' onclick='window.location.href=\"/manager/article/edit?id="+n.id+"\"'>编辑</button><button class='a3' onclick='discard("+n.id+")'>丢弃</button></td>";
                            }
                            if(data == 2){
                                content += "<td id='tranbtn'><button class='a1' onclick='lowerShelf("+n.id+")'>下架</button><button class='a3' onclick='discard("+n.id+")'>丢弃</button></td>";
                            }
                            if(data == 3){
                                content += "<td id='tranbtn'><button class='a1' onclick='reduction("+n.id+")'>还原</button><button class='a3' onclick='destruction("+n.id+")'>永久销毁</button></td>";
                            }

                            content += "</tr>";
                        });
                        var a = "#data"+data; //拼接一个id
                        var b = ".data"+data;//拼接一个class
                        $(".table "+a).html(content);
                        var fcontent = "";
                        fcontent += "<li onclick='loadData("+data+","+5+","+1+")'>首页</li>";
                        if(page.pageno == 1){
                            fcontent += "<li onclick='loadData("+data+","+5+","+1+")'>上一页</li>";
                        }else{
                            fcontent += "<li onclick='loadData("+data+","+5+","+(page.pageno-1)+")'>上一页</li>";
                        }
                        if(page.pageno == page.totalno){
                            fcontent += "<li onclick='loadData("+data+","+5+","+page.totalno+")'>下一页</li>";
                        }else{
                            fcontent += "<li onclick='loadData("+data+","+5+","+(page.pageno+1)+")'>下一页</li>";
                        }
                        var tcontent = "第"+page.pageno+" /"+page.totalno+"页";
                        $(b+" .tleft").html(tcontent);
                        /*分页栏*/
                        fcontent += "<li onclick='loadData("+data+","+5+","+page.totalno+")'>尾页</li>";

                        $(b+" .hfoot").html(fcontent);
                    }
                    else{
                        var a = "#data"+data; //拼接一个id
                        var b = ".data"+data;//拼接一个class
                        var content ="<tr>";
                        content += "<td colspan='8' style='text-align: center'>暂无数据</td>";
                        content += "</tr>";
                        $(".table "+a).html(content);
                    }

                }
                else{
                     layer.msg(result.message, {time:1000, icon:5, shift:6});
                }
            }
        })
    }
    //编辑
    $("#editbtn").click(function(){
        window.location.href="/manager/article/edit/";
    });
    //发布
    function release(id){
        $.ajax({
            type : "post",
            url : "/manager/article/release",
            data : {
                "id" : id,
                "status" : "1"
            },
            success : function(result){
                if(result.success){
                    layer.msg("发布文章成功！", {time:2000, icon:6});
                    showtab2();
                }else{
                    layer.msg("发布文章失败！", {time:2000, icon:5,shift:6});
                }
            }
        });
    }
    //丢弃
    function discard(id){
        layer.confirm("确定要丢弃吗？",  {icon: 3, title:'提示'}, function(cindex){
            $.ajax({
                type : "post",
                url : "/manager/article/discard",
                data : {
                    "id" : id,
                    "status" : "3"
                },
                success : function(result){
                    if(result.success){
                        layer.msg("丢弃文章成功！", {time:2000, icon:6});
                        showtab4();
                    }else{
                        layer.msg("丢弃文章失败！", {time:2000, icon:5,shift:6});
                    }
                }
            });
            layer.close(cindex);
        }, function(cindex){
            layer.close(cindex);
        });


    }
    //还原
    function reduction(id){
        $.ajax({
            type : "post",
            url : "/manager/article/reduction",
            data : {
                "id" : id,
                "status" : "0"
            },
            success : function(result){
                if(result.success){
                    layer.msg("还原文章成功！", {time:2000, icon:6});
                    showtab3();
                }else{
                    layer.msg("还原文章失败！", {time:2000, icon:5,shift:6});
                }
            }
        });
    }
    //销毁
    function destruction(id){
        layer.confirm("确定要销毁吗?",  {icon: 3, title:'提示'}, function(cindex){
            $.ajax({
                type : "post",
                url : "/manager/article/destruction",
                data : {
                    "id" : id,
                },
                success : function(result){
                    if(result.success){
                        layer.msg("销毁文章成功！", {time:2000, icon:6});
                        showtab4();
                    }else{
                        layer.msg("销毁文章失败！", {time:2000, icon:5,shift:6});
                    }
                }
            });
            layer.close(cindex);
        }, function(cindex){
            layer.close(cindex);
        });


    }
    //下架
    function lowerShelf(id){
        layer.confirm("确定要下架吗?",  {icon: 3, title:'提示'}, function(cindex){
            $.ajax({
                type : "post",
                url : "/manager/article/lowerShelf",
                data : {
                    "id" : id,
                    "status" : "1",
                },
                success : function(result){
                    if(result.success){
                        layer.msg("下架文章成功！", {time:2000, icon:6});
                        showtab2();
                    }else{
                        layer.msg("下架文章失败！", {time:2000, icon:5,shift:6});
                    }
                }
            });
            layer.close(cindex);
        }, function(cindex){
            layer.close(cindex);
        });
    }
    //上架
    function  upperShelf(id){
        layer.confirm("确定要上架吗?",  {icon: 3, title:'提示'}, function(cindex){
            $.ajax({
                type : "post",
                url : "/manager/article/upperShelf",
                data : {
                    "id" : id,
                    "status" : "2",
                },
                success : function(result){
                    if(result.success){
                        layer.msg("上架文章成功！", {time:2000, icon:6});
                        showtab1();
                    }else{
                        layer.msg(result.message, {time:2000, icon:5,shift:6});
                    }
                }
            });
            layer.close(cindex);
        }, function(cindex){
            layer.close(cindex);
        });
    }
    //获取请求地址的参数
    function GetQueryString(name)
    {
        var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if(r!=null)return  unescape(r[2]); return null;
    }

</script>
</body>
</html>
