<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>博客首页</title>

    <link href="webjars/bootstrap/3.3.7/css/bootstrap.min.css" th:href="@{webjars/bootstrap/3.3.7/css/bootstrap.min.css}" rel="stylesheet">
    <link href="/assets/css/potal/search.css" rel="stylesheet">
    <!--分页插件-->
    <link href="/pagination/pagination.css" rel="stylesheet">
</head>
<body>
<div class="container">
    <div class="row">
    <div class="col-lg-12">
        <span class="top">欢迎光临！<a href="/toLogin">登录 </a></span>
    </div>
</div>
</div>
<nav class="navbar navbar-default navbar-color" role="navigation" style="background: #0099CC">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse"
                    data-target="#example-navbar-collapse">
                <span class="sr-only">切换导航</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">个人博客</a>
        </div>
        <div class="collapse navbar-collapse" id="example-navbar-collapse">
            <ul class="nav navbar-nav" id="nav">
                <li><a href="/">首页</a></li>
            </ul>
            <form class="navbar-form navbar-right" style="margin-right:-40px">
                <div class="form-group">
                    <input type="text" class="form-control" placeholder="搜索关键字" name="keycode">
                </div>
                <button type="submit" class="btn btn-default glyphicon glyphicon-search" style="color: #0099CC"></button>
            </form>
        </div>
    </div>
</nav>
<div class="container">
    <div class="row" id="keycode"></div>
    <div class="row">
        <div class="col-lg-12" id="content">

        </div>
    </div>
    <div class="row" style="height: 100px">
        <div id="Pagination" class="pagination"><!-- 这里显示分页 --></div>
    </div>
</div>
<div class="footer">

</div>
<script src="/plugins/jQuery/jQuery-2.1.4.min.js"></script>
<script src="/bootstrap/js/bootstrap.js"></script>
<!--分页插件-->
<script src="/pagination/jquery.pagination.js"></script>
<script>

    window.onload=function(){
        loadNav();
        search(0);
    }
    //加载导航条
    function loadNav(){
        $.ajax({
            type:"post",
            url: "/loadNav",
            success : function(result){
                if(result.success){
                    var data = result.typeList;
                    var content = "";
                    $.each(data,function(i,n){
                        if(n.typeList.length != 0){
                           content += " <li class='dropdown'>";
                           content += "<a href='"+n.url+"?id="+n.id+"' class='dropdown-toggle' data-toggle='dropdown'>";
                           content +=n.name+ "<b class='caret'></b>";
                           content += " </a>";
                           content += "<ul  class='dropdown-menu'>";
                           $.each(n.typeList,function(i,b){
                                content += "<li><a href='"+b.url+"?id="+b.id+"'>"+b.name+"</a></li>";
                            });
                           content += "</ul>";
                           content += "</li>";
                        }else{
                            content += "<li><a href='"+n.url+"?id="+n.id+"'>"+n.name+"</a></li>";
                        }
                    });
                    $("#nav").append(content);
                }else{
                    alert("系统异常！");
                }
            }
        })
    }

    function search(pageIndex){
       var keycode = GetQueryString("keycode");
        $.ajax({
          type : "post",
          url : "/doSearch",
          data : {
              "keycode" : keycode,
              "pageno" : pageIndex+1,
              "pagesize" : 14,
          },
          success :function(result){
              if(result.success){
                  var page = result.page;
                  var data = page.articleResults;
                  var keycode = GetQueryString("keycode");
                  var keycodecontent = "搜索 "+keycode+" 找到"+data.length+" 个与之相关的文章";
                  $("#keycode").html(keycodecontent);
                  var content = "";
                  content += "<ul>";
                  $.each(data,function(i,n){
                      content += "<li>";
                      content += "<a href='/article?id="+n.id+"'>"+n.title+"</a>";
                      content += "<span>"+n.creationtime+"</span>";
                      content += "</li>";
                  });
                  content += "</ul>";
                  $("#content").html(content);
                  // 创建分页
                  var num_entries = page.totalsize ;
                  $("#Pagination").pagination(num_entries, {
                      num_edge_entries: 2, //边缘页数
                      num_display_entries: 4, //主体页数
                      callback: search,
                      items_per_page:page.pagesize, //每页显示1项
                      current_page:(page.pageno-1), //当前页,索引从0开始
                      prev_text:"上一页",
                      next_text:"下一页"
                  });
              }else{
                  var content =  "<div class='row'>搜索 java 找到0 个与之相关的文章</div>";
                  content += "<div class='row'>";
                  content += "<div class='col-lg-12' id='content'>";
                  content += "<header>";
                  content += "<h1 class='pagetile'>没有您要找的文章！</h1>";
                  content += "</header>";
                  content += "<p>可以尝试使用右上角的搜索功能，查找您喜欢的文章！</p>";
                  content += "<p> <img src='/image/rename.jpg'></p>";
                  content += "</div>";
                  content += "</div>";
                  $("#container").html(content);
              }
          }
      })
    }
    //获取请求地址的参数
    function GetQueryString(name) {
        var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if(r!=null)return  unescape(r[2]); return null;
    }
    $(document).ready(function(){
        $(document).off('click.bs.dropdown.data-api');
    });
</script>
<script>

</script>
</body>
</html>